<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–≥–æ–¥–∞ –≤ –†–æ—Å—Å–∏–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://api-maps.yandex.ru/2.1/?apikey=–≤–∞—à_api_–∫–ª—é—á&lang=ru_RU" type="text/javascript"></script>
    <style>
        .weather-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .search-popup {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .wind-direction {
            display: inline-block;
            transition: transform 0.3s ease;
        }
        .hourly-item {
            transition: all 0.2s ease;
        }
        .hourly-item:hover {
            transform: scale(1.05);
        }
        .forecast-day {
            transition: all 0.2s ease;
        }
        .forecast-day:hover {
            transform: translateY(-3px);
        }
        .map-container {
            height: 300px;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        #map {
            height: 100%;
            width: 100%;
        }
        .emoji-weather {
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }
        .dark {
            background-color: #111827;
            color: #f3f4f6;
        }
        .dark .bg-white {
            background-color: #1f2937;
            color: #f3f4f6;
        }
        .dark .text-gray-600 {
            color: #9ca3af;
        }
        .dark .bg-indigo-50 {
            background-color: #3730a3;
        }
        .dark .bg-gray-50 {
            background-color: #374151;
        }
        .dark .text-indigo-800 {
            color: #818cf8;
        }
        .dark .text-indigo-600 {
            color: #818cf8;
        }
        .dark .text-blue-500 {
            color: #60a5fa;
        }
        .dark .text-red-500 {
            color: #f87171;
        }
        .theme-transition {
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .tab-active {
            border-bottom: 3px solid #4f46e5;
            font-weight: 600;
            color: #4f46e5;
        }
        .dark .tab-active {
            border-bottom-color: #818cf8;
            color: #818cf8;
        }
        .scroll-container {
            scrollbar-width: thin;
            scrollbar-color: #c7d2fe #f1f5f9;
        }
        .dark .scroll-container {
            scrollbar-color: #4f46e5 #1f2937;
        }
        .scroll-container::-webkit-scrollbar {
            height: 8px;
        }
        .scroll-container::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        .dark .scroll-container::-webkit-scrollbar-track {
            background: #1f2937;
        }
        .scroll-container::-webkit-scrollbar-thumb {
            background-color: #c7d2fe;
            border-radius: 10px;
        }
        .dark .scroll-container::-webkit-scrollbar-thumb {
            background-color: #4f46e5;
        }
        .temperature-bar {
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #3b82f6, #ef4444);
        }
        .temperature-indicator {
            position: relative;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }
        .forecast-toggle {
            background-color: #e0e7ff;
        }
        .dark .forecast-toggle {
            background-color: #3730a3;
        }
        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            justify-items: center;
        }
        .today-highlight {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3), 0 2px 4px -1px rgba(79, 70, 229, 0.2);
        }
        .dark .today-highlight {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }
        .today-highlight .text-gray-500,
        .today-highlight .text-gray-600,
        .today-highlight .dark\\:text-gray-300 {
            color: rgba(255, 255, 255, 0.8) !important;
        }
        .today-highlight .text-blue-500,
        .today-highlight .text-red-500 {
            color: white !important;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen theme-transition">
    <div class="container mx-auto px-4 py-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-indigo-800 dark:text-indigo-300">–ü–æ–≥–æ–¥–∞ –≤ –†–æ—Å—Å–∏–∏ <span class="emoji-weather">üå§Ô∏è</span></h1>
                <p class="text-gray-600 dark:text-gray-300">–ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–≥–æ–¥–µ –≤ –≤–∞—à–µ–º –≥–æ—Ä–æ–¥–µ</p>
            </div>
            <div class="flex flex-wrap gap-2">
                <button id="themeToggle" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition flex items-center">
                    <i class="fas fa-moon mr-2"></i> –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
                </button>
                <button id="refreshBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition flex items-center">
                    <i class="fas fa-sync-alt mr-2"></i> –û–±–Ω–æ–≤–∏—Ç—å
                </button>
                <button id="searchBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition flex items-center">
                    <i class="fas fa-search mr-2"></i> –ü–æ–∏—Å–∫
                </button>
            </div>
        </div>

        <div id="searchPopup" class="hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-md search-popup dark:bg-gray-800">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold dark:text-white">–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞</h2>
                    <button id="closeSearch" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="relative">
                    <input type="text" id="cityInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥..." class="w-full p-3 border rounded-lg mb-4 pl-10 dark:bg-gray-700 dark:text-white dark:border-gray-600">
                    <i class="fas fa-search absolute left-3 top-4 text-gray-400"></i>
                </div>
                <div id="searchResults" class="max-h-96 overflow-y-auto border rounded-lg dark:bg-gray-700 dark:border-gray-600"></div>
            </div>
        </div>

        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="space-y-6">
            <!-- –¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞ -->
            <div id="currentWeather" class="bg-white rounded-xl shadow-md p-6 weather-card transition dark:bg-gray-800">
                <!-- –¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>

            <!-- –ü–æ—á–∞—Å–æ–≤–∞—è –ø–æ–≥–æ–¥–∞ -->
             
            <div class="bg-white rounded-xl shadow-md p-6 dark:bg-gray-800">
                <h2 class="text-xl font-semibold mb-4 flex items-center dark:text-white">
                    <i class="fas fa-clock mr-2 text-indigo-600 dark:text-indigo-400"></i> –ü–æ—á–∞—Å–æ–≤–∞—è –ø–æ–≥–æ–¥–∞
                </h2>
                <div id="hourlyWeather" class="flex overflow-x-auto pb-2 space-x-4 scroll-container">
                    <!-- –ü–æ—á–∞—Å–æ–≤–∞—è –ø–æ–≥–æ–¥–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>

            <!-- –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω–µ–π -->
            <div class="bg-white rounded-xl shadow-md p-6 dark:bg-gray-800">
                <h2 class="text-xl font-semibold mb-4 flex items-center dark:text-white">
                    <i class="fas fa-calendar-alt mr-2 text-indigo-600 dark:text-indigo-400"></i> –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω–µ–π
                </h2>
                
                <div id="weekForecast" class="forecast-grid">
                    <!-- –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –Ω–µ–¥–µ–ª—é –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>

            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="bg-white rounded-xl shadow-md p-6 dark:bg-gray-800">
                <h2 class="text-xl font-semibold mb-4 flex items-center dark:text-white">
                    <i class="fas fa-chart-bar mr-2 text-indigo-600 dark:text-indigo-400"></i> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-medium mb-3 text-indigo-700 dark:text-indigo-400">–£–§ –∏–Ω–¥–µ–∫—Å –∏ —Å–æ–ª–Ω—Ü–µ</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 dark:text-gray-300">–£–§ –∏–Ω–¥–µ–∫—Å:</span>
                                <span id="uvIndex" class="font-medium dark:text-white">3 (—É–º–µ—Ä–µ–Ω–Ω—ã–π)</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 dark:text-gray-300">–í–æ—Å—Ö–æ–¥:</span>
                                <span id="sunrise" class="font-medium dark:text-white">06:45</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 dark:text-gray-300">–ó–∞–∫–∞—Ç:</span>
                                <span id="sunset" class="font-medium dark:text-white">18:30</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 dark:text-gray-300">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–Ω—è:</span>
                                <span id="dayLength" class="font-medium dark:text-white">11—á 45–º</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium mb-3 text-indigo-700 dark:text-indigo-400">–û—Å–∞–¥–∫–∏ –∏ –≤–∏–¥–∏–º–æ—Å—Ç—å</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 dark:text-gray-300">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–æ–∂–¥—è:</span>
                                <span id="rainProbability" class="font-medium dark:text-white">10%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 dark:text-gray-300">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–Ω–µ–≥–∞:</span>
                                <span id="snowProbability" class="font-medium dark:text-white">0%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 dark:text-gray-300">–í–∏–¥–∏–º–æ—Å—Ç—å:</span>
                                <span id="visibility" class="font-medium dark:text-white">10 –∫–º</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 dark:text-gray-300">–¢–æ—á–∫–∞ —Ä–æ—Å—ã:</span>
                                <span id="dewPoint" class="font-medium dark:text-white">5¬∞C</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–∞ –∏ –∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-md p-6 dark:bg-gray-800">
                    <h2 class="text-xl font-semibold mb-4 flex items-center dark:text-white">
                        <i class="fas fa-map-marker-alt mr-2 text-indigo-600 dark:text-indigo-400"></i> –ö–∞—Ä—Ç–∞ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏
                    </h2>
                    <div class="map-container">
                        <div id="map"></div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md p-6 dark:bg-gray-800">
                    <h2 class="text-xl font-semibold mb-4 flex items-center dark:text-white">
                        <i class="fas fa-moon mr-2 text-indigo-600 dark:text-indigo-400"></i> –ê—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-indigo-50 dark:bg-indigo-900 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-sun text-yellow-500 mr-2"></i>
                                <span class="font-medium dark:text-white">–§–∞–∑–∞ –ª—É–Ω—ã</span>
                            </div>
                            <div id="moonPhase" class="text-gray-600 dark:text-gray-300">–†–∞—Å—Ç—É—â–∞—è –ª—É–Ω–∞</div>
                        </div>
                        <div class="bg-indigo-50 dark:bg-indigo-900 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-star text-blue-400 mr-2"></i>
                                <span class="font-medium dark:text-white">–í–∏–¥–∏–º–æ—Å—Ç—å –∑–≤—ë–∑–¥</span>
                            </div>
                            <div id="starVisibility" class="text-gray-600 dark:text-gray-300">–•–æ—Ä–æ—à–∞—è</div>
                        </div>
                        <div class="bg-indigo-50 dark:bg-indigo-900 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-cloud-moon text-gray-400 mr-2"></i>
                                <span class="font-medium dark:text-white">–õ—É–Ω–Ω—ã–π —Å–≤–µ—Ç</span>
                            </div>
                            <div id="moonLight" class="text-gray-600 dark:text-gray-300">–Ø—Ä–∫–∏–π</div>
                        </div>
                        <div class="bg-indigo-50 dark:bg-indigo-900 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-umbrella text-indigo-400 mr-2"></i>
                                <span class="font-medium dark:text-white">–ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ</span>
                            </div>
                            <div id="atmosphericPressure" class="text-gray-600 dark:text-gray-300">1015 hPa</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = '173A01557B9157D5DAE97916240C18AD';
        const cities = [
            {n: '–ú–æ—Å–∫–≤–∞', id: 524901, lat: 55.7558, lon: 37.6173},
            {n: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', id: 498817, lat: 59.9343, lon: 30.3351},
            {n: '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', id: 1496747, lat: 55.0084, lon: 82.9357},
            {n: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', id: 1486209, lat: 56.8389, lon: 60.6057},
            {n: '–ö–∞–∑–∞–Ω—å', id: 551487, lat: 55.7961, lon: 49.1064},
            {n: '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥', id: 520555, lat: 56.3269, lon: 44.0256},
            {n: '–ß–µ–ª—è–±–∏–Ω—Å–∫', id: 1508291, lat: 55.1644, lon: 61.4368},
            {n: '–°–∞–º–∞—Ä–∞', id: 499099, lat: 53.1959, lon: 50.1002},
            {n: '–û–º—Å–∫', id: 1496153, lat: 54.9924, lon: 73.3686},
            {n: '–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É', id: 501175, lat: 47.2225, lon: 39.7186},
            {n: '–£—Ñ–∞', id: 479561, lat: 54.7351, lon: 55.9587},
            {n: '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫', id: 1502026, lat: 56.0153, lon: 92.8932},
            {n: '–ü–µ—Ä–º—å', id: 551487, lat: 58.0105, lon: 56.2502},
            {n: '–í–æ—Ä–æ–Ω–µ–∂', id: 472045, lat: 51.6606, lon: 39.2006},
            {n: '–í–æ–ª–≥–æ–≥—Ä–∞–¥', id: 472757, lat: 48.7194, lon: 44.5018},
            {n: '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä', id: 542420, lat: 45.0355, lon: 38.9753},
            {n: '–°–∞—Ä–∞—Ç–æ–≤', id: 498677, lat: 51.5924, lon: 45.9608},
            {n: '–¢—é–º–µ–Ω—å', id: 1488754, lat: 57.1522, lon: 65.5272},
            {n: '–¢–æ–ª—å—è—Ç—Ç–∏', id: 482283, lat: 53.5078, lon: 49.4204},
            {n: '–ò–∂–µ–≤—Å–∫', id: 554840, lat: 56.8527, lon: 53.2045},
            {n: '–ë—Ä—è–Ω—Å–∫', id: 571476, lat: 53.2434, lon: 34.3642}
        ];

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const searchBtn = document.getElementById('searchBtn');
        const searchPopup = document.getElementById('searchPopup');
        const closeSearch = document.getElementById('closeSearch');
        const cityInput = document.getElementById('cityInput');
        const searchResults = document.getElementById('searchResults');
        const refreshBtn = document.getElementById('refreshBtn');
        const themeToggle = document.getElementById('themeToggle');
        const currentWeather = document.getElementById('currentWeather');
        const hourlyWeather = document.getElementById('hourlyWeather');
        const weekForecast = document.getElementById('weekForecast');
        const uvIndexElement = document.getElementById('uvIndex');
        const sunriseElement = document.getElementById('sunrise');
        const sunsetElement = document.getElementById('sunset');
        const dayLengthElement = document.getElementById('dayLength');
        const rainProbabilityElement = document.getElementById('rainProbability');
        const snowProbabilityElement = document.getElementById('snowProbability');
        const visibilityElement = document.getElementById('visibility');
        const dewPointElement = document.getElementById('dewPoint');
        const moonPhaseElement = document.getElementById('moonPhase');
        const starVisibilityElement = document.getElementById('starVisibility');
        const moonLightElement = document.getElementById('moonLight');
        const atmosphericPressureElement = document.getElementById('atmosphericPressure');
        const mapElement = document.getElementById('map');
        const body = document.body;

        let activeCityId = 524901; // ID –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ú–æ—Å–∫–≤–∞)
        let map;
        let placemark;
        let isDarkMode = false;
        let forecastData = null;
        let todayDate = new Date().toLocaleDateString('ru-RU'); // –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É
            if (localStorage.getItem('darkMode') === 'true') {
                enableDarkMode();
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–≥–æ–¥—É –¥–ª—è –ú–æ—Å–∫–≤—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            getWeather(524901, '–ú–æ—Å–∫–≤–∞');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
            initMap(55.7558, 37.6173);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            setInterval(() => {
                todayDate = new Date().toLocaleDateString('ru-RU');
                updateTodayHighlight();
            }, 60000);
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã Yandex
        function initMap(lat, lon) {
            ymaps.ready(() => {
                map = new ymaps.Map('map', {
                    center: [lat, lon],
                    zoom: 11,
                    controls: ['zoomControl']
                }, {
                    searchControlProvider: 'yandex#search'
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É
                placemark = new ymaps.Placemark([lat, lon], {
                    hintContent: '–¢–µ–∫—É—â–∏–π –≥–æ—Ä–æ–¥',
                    balloonContent: '–í—ã–±—Ä–∞–Ω–Ω—ã–π –≥–æ—Ä–æ–¥'
                }, {
                    preset: 'islands#blueDotIcon'
                });
                
                map.geoObjects.add(placemark);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
        function updateMapPosition(lat, lon) {
            if (map && placemark) {
                map.setCenter([lat, lon], 11);
                placemark.geometry.setCoordinates([lat, lon]);
            } else {
                initMap(lat, lon);
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
        function enableDarkMode() {
            body.classList.remove('bg-gradient-to-br', 'from-blue-50', 'to-indigo-100');
            body.classList.add('dark', 'bg-gray-900');
            themeToggle.innerHTML = '<i class="fas fa-sun mr-2"></i> –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
            isDarkMode = true;
            localStorage.setItem('darkMode', 'true');
        }

        function disableDarkMode() {
            body.classList.add('bg-gradient-to-br', 'from-blue-50', 'to-indigo-100');
            body.classList.remove('dark', 'bg-gray-900');
            themeToggle.innerHTML = '<i class="fas fa-moon mr-2"></i> –¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
            isDarkMode = false;
            localStorage.setItem('darkMode', 'false');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è
        function updateTodayHighlight() {
            const forecastDays = document.querySelectorAll('.forecast-day');
            forecastDays.forEach(day => {
                const dayDate = day.getAttribute('data-date');
                if (dayDate === todayDate) {
                    day.classList.add('today-highlight');
                } else {
                    day.classList.remove('today-highlight');
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        searchBtn.addEventListener('click', () => {
            searchPopup.classList.remove('hidden');
            cityInput.focus();
        });

        closeSearch.addEventListener('click', () => {
            searchPopup.classList.add('hidden');
        });

        refreshBtn.addEventListener('click', () => {
            const activeCity = cities.find(c => c.id === activeCityId);
            if (activeCity) {
                getWeather(activeCity.id, activeCity.n);
            }
        });

        themeToggle.addEventListener('click', () => {
            if (isDarkMode) {
                disableDarkMode();
            } else {
                enableDarkMode();
            }
        });

        cityInput.addEventListener('input', () => {
            const query = cityInput.value.toLowerCase();
            const results = cities.filter(city => 
                city.n.toLowerCase().includes(query)
            ).slice(0, 10);
            
            searchResults.innerHTML = '';
            
            if (results.length === 0) {
                const emptyElement = document.createElement('div');
                emptyElement.className = 'p-3 text-center text-gray-500 dark:text-gray-300';
                emptyElement.textContent = '–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω';
                searchResults.appendChild(emptyElement);
            } else {
                results.forEach(city => {
                    const cityElement = document.createElement('div');
                    cityElement.className = 'p-3 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer flex justify-between items-center dark:text-white';
                    cityElement.innerHTML = `
                        <div>${city.n}</div>
                    `;
                    cityElement.addEventListener('click', () => {
                        getWeather(city.id, city.n);
                        searchPopup.classList.add('hidden');
                        activeCityId = city.id;
                    });
                    searchResults.appendChild(cityElement);
                });
            }
        });

        function getWeatherEmoji(weatherCode) {
            // –ì—Ä—É–ø–ø—ã –ø–æ–≥–æ–¥—ã –ø–æ –∫–æ–¥–∞–º OpenWeatherMap
            const thunderstorm = [200, 201, 202, 210, 211, 212, 221, 230, 231, 232]; // –ì—Ä–æ–∑–∞
            const drizzle = [300, 301, 302, 310, 311, 312, 313, 314, 321]; // –ú–æ—Ä–æ—Å—å
            const rain = [500, 501, 502, 503, 504, 511, 520, 521, 522, 531]; // –î–æ–∂–¥—å
            const snow = [600, 601, 602, 611, 612, 613, 615, 616, 620, 621, 622]; // –°–Ω–µ–≥
            const atmosphere = [701, 711, 721, 731, 741, 751, 761, 762, 771, 781]; // –¢—É–º–∞–Ω, –ø—ã–ª—å –∏ —Ç.–¥.
            const clear = [800]; // –Ø—Å–Ω–æ
            const clouds = [801, 802, 803, 804]; // –û–±–ª–∞—á–Ω–æ
            
            if (thunderstorm.includes(weatherCode)) return '‚õàÔ∏è';
            if (drizzle.includes(weatherCode)) return 'üåßÔ∏è';
            if (rain.includes(weatherCode)) return 'üåßÔ∏è';
            if (snow.includes(weatherCode)) return '‚ùÑÔ∏è';
            if (atmosphere.includes(weatherCode)) return 'üå´Ô∏è';
            if (clear.includes(weatherCode)) return '‚òÄÔ∏è';
            if (clouds.includes(weatherCode)) return '‚òÅÔ∏è';
            
            return 'üåà';
        }

        function getMoonPhaseEmoji(phase) {
            if (phase < 0.1) return 'üåë';
            if (phase < 0.3) return 'üåí';
            if (phase < 0.4) return 'üåì';
            if (phase < 0.6) return 'üåî';
            if (phase < 0.7) return 'üåï';
            if (phase < 0.8) return 'üåñ';
            if (phase < 0.9) return 'üåó';
            return 'üåò';
        }

        function getMoonPhaseName(phase) {
            if (phase < 0.1) return '–ù–æ–≤–æ–ª—É–Ω–∏–µ';
            if (phase < 0.3) return '–†–∞—Å—Ç—É—â–∏–π —Å–µ—Ä–ø';
            if (phase < 0.4) return '–ü–µ—Ä–≤–∞—è —á–µ—Ç–≤–µ—Ä—Ç—å';
            if (phase < 0.6) return '–†–∞—Å—Ç—É—â–∞—è –ª—É–Ω–∞';
            if (phase < 0.7) return '–ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ';
            if (phase < 0.8) return '–£–±—ã–≤–∞—é—â–∞—è –ª—É–Ω–∞';
            if (phase < 0.9) return '–ü–æ—Å–ª–µ–¥–Ω—è—è —á–µ—Ç–≤–µ—Ä—Ç—å';
            return '–£–±—ã–≤–∞—é—â–∏–π —Å–µ—Ä–ø';
        }

        async function getWeather(id, name) {
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                currentWeather.innerHTML = `
                    <div class="flex justify-center items-center h-40">
                        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"></div>
                    </div>
                `;
                
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?id=${id}&appid=${apiKey}&units=metric&lang=ru`);
                const data = await response.json();
                
                // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω–µ–π (56 —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö - 7 –¥–Ω–µ–π –ø–æ 8 —Ç–æ—á–µ–∫ –≤ –¥–µ–Ω—å)
                const forecastResponse = await fetch(`https://api.openweathermap.org/data/2.5/forecast?id=${id}&appid=${apiKey}&units=metric&lang=ru&cnt=56`);
                forecastData = await forecastResponse.json();
                
                updateWeather(data, name);
                updateHourlyWeather(forecastData);
                updateForecastWeather(forecastData);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç—É
                updateMapPosition(data.coord.lat, data.coord.lon);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
                updateAstronomicalData(data);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
                todayDate = new Date().toLocaleDateString('ru-RU');
                updateTodayHighlight();
            } catch (error) {
                console.error('Error:', error);
                currentWeather.innerHTML = `
                    <div class="text-center p-6 text-red-500">
                        <i class="fas fa-exclamation-triangle text-3xl mb-4"></i>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>
                    </div>
                `;
            }
        }

        function updateWeather(data, name) {
            const temp = Math.round(data.main.temp);
            const feelsLike = Math.round(data.main.feels_like);
            const weatherDesc = data.weather[0].description;
            const weatherEmoji = getWeatherEmoji(data.weather[0].id);
            const icon = data.weather[0].icon;
            const humidity = data.main.humidity;
            const windSpeed = Math.round(data.wind.speed * 3.6);
            const windDeg = data.wind.deg;
            const pressure = data.main.pressure;
            const visibility = data.visibility / 1000;
            const tempMin = Math.round(data.main.temp_min);
            const tempMax = Math.round(data.main.temp_max);
            const clouds = data.clouds ? data.clouds.all : 0;
            const dewPoint = Math.round(data.main.temp - (100 - data.main.humidity) / 5);
            
            const now = new Date();
            const date = now.toLocaleDateString('ru-RU', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            currentWeather.innerHTML = `
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-semibold dark:text-white">${name} ${weatherEmoji}</h2>
                        <p class="text-gray-500 dark:text-gray-300">${date}</p>
                    </div>
                    <div class="flex items-center">
                        <span class="text-sm text-gray-500 dark:text-gray-300 mr-2">–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${now.toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'})}</span>
                        <i class="fas fa-check-circle text-green-500"></i>
                    </div>
                </div>
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-6 md:mb-0">
                        <div class="text-5xl font-bold mb-2 dark:text-white">${temp}¬∞C</div>
                        <div class="text-gray-500 mb-4 dark:text-gray-300">${weatherDesc}, –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ ${feelsLike}¬∞C</div>
                        <div class="flex space-x-4">
                            <div class="flex items-center dark:text-white">
                                <i class="fas fa-temperature-low mr-2 text-blue-400"></i>
                                <span>${tempMin}¬∞C</span>
                            </div>
                            <div class="flex items-center dark:text-white">
                                <i class="fas fa-temperature-high mr-2 text-red-400"></i>
                                <span>${tempMax}¬∞C</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-center">
                        <img src="https://openweathermap.org/img/wn/${icon}@4x.png" alt="weather icon" class="w-24 h-24 mx-auto">
                        <p class="text-gray-500 mt-2 dark:text-gray-300">–û–±–ª–∞—á–Ω–æ—Å—Ç—å: ${clouds}%</p>
                    </div>
                    <div class="bg-indigo-50 dark:bg-indigo-900 rounded-lg p-4 mt-4 md:mt-0">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <div class="text-gray-600 dark:text-gray-300">–í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
                                <div class="text-xl font-bold dark:text-white">${humidity}%</div>
                            </div>
                            <div>
                                <div class="text-gray-600 dark:text-gray-300">–í–µ—Ç–µ—Ä</div>
                                <div class="text-xl font-bold flex items-center dark:text-white">
                                    ${windSpeed} –∫–º/—á
                                    <i class="fas fa-arrow-up wind-direction ml-2" style="transform: rotate(${windDeg}deg);"></i>
                                </div>
                            </div>
                            <div>
                                <div class="text-gray-600 dark:text-gray-300">–î–∞–≤–ª–µ–Ω–∏–µ</div>
                                <div class="text-xl font-bold dark:text-white">${pressure} hPa</div>
                            </div>
                            <div>
                                <div class="text-gray-600 dark:text-gray-300">–í–∏–¥–∏–º–æ—Å—Ç—å</div>
                                <div class="text-xl font-bold dark:text-white">${visibility} –∫–º</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            updateAdditionalInfo(data);
        }

function updateHourlyWeather(data) {
    hourlyWeather.innerHTML = '';
    for (let i = 0; i < 24; i++) {
        const forecast = data.list[i];
        const date = new Date(forecast.dt * 1000);
        const hours = date.getHours().toString().padStart(2, '0');
        const minutes = date.getMinutes().toString().padStart(2, '0');
        const temp = Math.round(forecast.main.temp);
        const icon = forecast.weather[0].icon;
        const weatherEmoji = getWeatherEmoji(forecast.weather[0].id);
        const humidity = forecast.main.humidity || 0;

        const hourlyItem = document.createElement('div');
        // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –±–ª–æ–∫ –≤—ã—Ä–æ–≤–Ω–µ–Ω –ø–æ —Ü–µ–Ω—Ç—Ä—É, –¥–æ–±–∞–≤–∏–º –∫–ª–∞—Å—Å flex-col, –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ
        hourlyItem.className = 'hourly-item bg-gray-50 dark:bg-gray-700 rounded-lg p-3 flex flex-col items-center min-w-16';

        // –û–±–Ω–æ–≤–ª—è–µ–º innerHTML —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–∏–∂–Ω–∏–π –±–ª–æ–∫ –±—ã–ª flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º:
        hourlyItem.innerHTML = `
            <div class="text-sm font-medium dark:text-white mb-2">${hours}:${minutes}</div>
            <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="weather icon" class="w-10 h-10 mb-2">
            <div class="flex flex-col items-center justify-center font-bold dark:text-white mb-2">
                <span>${temp}¬∞C</span>
                <span>${weatherEmoji}</span>
            </div>
            <div class="text-xs text-gray-500 dark:text-gray-300">${humidity}%</div>
        `;
        hourlyWeather.appendChild(hourlyItem);
    }
}
function updateForecastWeather(data) {
    weekForecast.innerHTML = '';
    
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ –¥–Ω—è–º
    const dailyForecast = {};
    data.list.forEach(item => {
        const date = new Date(item.dt * 1000);
        const dayKey = date.toLocaleDateString('ru-RU');
        
        if (!dailyForecast[dayKey]) {
            dailyForecast[dayKey] = {
                date: date,
                temp_min: item.main.temp_min,
                temp_max: item.main.temp_max,
                icon: item.weather[0].icon,
                description: item.weather[0].description,
                weatherId: item.weather[0].id,
                humidity: item.main.humidity,
                windSpeed: Math.round(item.wind.speed * 3.6),
                windDeg: item.wind.deg,
                pop: item.pop // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Å–∞–¥–∫–æ–≤
            };
        } else {
            if (item.main.temp_min < dailyForecast[dayKey].temp_min) {
                dailyForecast[dayKey].temp_min = item.main.temp_min;
            }
            if (item.main.temp_max > dailyForecast[dayKey].temp_max) {
                dailyForecast[dayKey].temp_max = item.main.temp_max;
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Å–∞–¥–∫–æ–≤ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –∑–∞ –¥–µ–Ω—å
            if (item.pop > dailyForecast[dayKey].pop) {
                dailyForecast[dayKey].pop = item.pop;
            }
        }
    });
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–Ω–∏ –ø–æ –¥–∞—Ç–µ
    const sortedDays = Object.keys(dailyForecast).sort((a, b) => {
        return new Date(a) - new Date(b);
    });
    
    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω–µ–π
    sortedDays.slice(0, 7).forEach(dayKey => {
        const forecast = dailyForecast[dayKey];
        const dayName = forecast.date.toLocaleDateString('ru-RU', { weekday: 'long' });
        const dateStr = forecast.date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
        const tempMin = Math.round(forecast.temp_min);
        const tempMax = Math.round(forecast.temp_max);
        const weatherEmoji = getWeatherEmoji(forecast.weatherId);
        const pop = Math.round(forecast.pop * 100); // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Å–∞–¥–∫–æ–≤
        const isToday = dayKey === todayDate;
        
        // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
        const tempRange = tempMax - tempMin;
        const tempPosition = tempRange > 0 ? ((tempMin + 15) / (tempMax + 15)) * 100 : 50;
        
const forecastDay = document.createElement('div');
forecastDay.className = `forecast-day bg-gray-50 dark:bg-gray-700 rounded-lg p-4 flex flex-col justify-between w-full max-w-xs ${isToday ? 'today-highlight' : ''}`;
forecastDay.setAttribute('data-date', dayKey);
forecastDay.innerHTML = `
  <div class="text-center mb-2">
    <div class="font-medium dark:text-white">${dayName}</div>
    <div class="text-sm text-gray-500 dark:text-gray-300">${dateStr}</div>
  </div>
  <div class="flex justify-center mb-2">${weatherEmoji}</div>
  <img src="https://openweathermap.org/img/wn/${forecast.icon}@2x.png" alt="weather icon" class="w-12 h-12 mx-auto mb-2">
  <div class="text-sm text-gray-600 text-center mb-2 dark:text-gray-300">${forecast.description}</div>
  <div class="flex justify-around mb-2">
    <div class="text-blue-500 dark:text-blue-400">${tempMin}¬∞</div>
    <div class="text-red-500 dark:text-red-400">${tempMax}¬∞</div>
  </div>
  <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã -->
  <div class="flex flex-col justify-between h-full">
    <div class="flex justify-around mb-2">
      <!-- –í–µ—Ç–µ—Ä -->
      <div class="flex flex-col items-center w-24 mb-2">
        <div class="flex items-center justify-center mb-1">
          <i class="fas fa-wind text-gray-400"></i>
        </div>
        <div class="text-center dark:text-gray-300">${forecast.windSpeed} –∫–º/—á</div>
      </div>
      <!-- –í–ª–∞–∂–Ω–æ—Å—Ç—å -->
      <div class="flex flex-col items-center w-24 mb-2">
        <div class="flex items-center justify-center mb-1">
          <i class="fas fa-tint text-blue-400"></i>
        </div>
        <div class="text-center dark:text-gray-300">${forecast.humidity}%</div>
      </div>
    </div>
    ${pop > 0 ? `
    <div class="flex flex-col items-center mb-2">
      <div class="flex items-center justify-center mb-1">
        <i class="fas fa-umbrella text-blue-400"></i>
      </div>
      <div class="text-center dark:text-gray-300">${pop}% –æ—Å–∞–¥–∫–æ–≤</div>
    </div>
    ` : ''}
  </div>
`;
        weekForecast.appendChild(forecastDay);
    });
}
        function updateAdditionalInfo(data) {
            // –£–§ –∏–Ω–¥–µ–∫—Å (–ø—Ä–∏–º–µ—Ä–Ω—ã–π)
            const uvIndex = Math.floor(Math.random() * 5) + 1;
            let uvText = '';
            if (uvIndex <= 2) uvText = '–Ω–∏–∑–∫–∏–π';
            else if (uvIndex <= 5) uvText = '—É–º–µ—Ä–µ–Ω–Ω—ã–π';
            else if (uvIndex <= 7) uvText = '–≤—ã—Å–æ–∫–∏–π';
            else uvText = '–æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π';
            
            uvIndexElement.textContent = `${uvIndex} (${uvText})`;
            
            // –í–æ—Å—Ö–æ–¥ –∏ –∑–∞–∫–∞—Ç
            const sunriseDate = new Date(data.sys.sunrise * 1000);
            const sunsetDate = new Date(data.sys.sunset * 1000);
            
            sunriseElement.textContent = sunriseDate.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            sunsetElement.textContent = sunsetDate.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            
            // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–Ω—è
            const dayLengthMs = sunsetDate - sunriseDate;
            const hours = Math.floor(dayLengthMs / (1000 * 60 * 60));
            const minutes = Math.floor((dayLengthMs % (1000 * 60 * 60)) / (1000 * 60));
            dayLengthElement.textContent = `${hours}—á ${minutes}–º`;
            
            // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Å–∞–¥–∫–æ–≤ (–ø—Ä–∏–º–µ—Ä–Ω–∞—è)
            let rainProb = 0;
            let snowProb = 0;
            
            if (data.weather[0].main === 'Rain') rainProb = 70;
            if (data.weather[0].main === 'Snow') snowProb = 70;
            if (data.weather[0].main === 'Drizzle') rainProb = 30;
            
            rainProbabilityElement.textContent = `${rainProb}%`;
            snowProbabilityElement.textContent = `${snowProb}%`;
            
            // –í–∏–¥–∏–º–æ—Å—Ç—å
            const visibility = data.visibility / 1000;
            visibilityElement.textContent = `${visibility} –∫–º`;
            
            // –¢–æ—á–∫–∞ —Ä–æ—Å—ã
            const dewPoint = Math.round(data.main.temp - (100 - data.main.humidity) / 5);
            dewPointElement.textContent = `${dewPoint}¬∞C`;
            
            // –î–∞–≤–ª–µ–Ω–∏–µ
            atmosphericPressureElement.textContent = `${data.main.pressure} hPa`;
        }

        function updateAstronomicalData(data) {
            // –§–∞–∑–∞ –ª—É–Ω—ã (–ø—Ä–∏–º–µ—Ä–Ω–∞—è)
            const now = new Date();
            const moonPhase = (now.getDate() % 29) / 29;
            const moonPhaseEmoji = getMoonPhaseEmoji(moonPhase);
            const moonPhaseName = getMoonPhaseName(moonPhase);
            
            moonPhaseElement.textContent = `${moonPhaseEmoji} ${moonPhaseName}`;
            
            // –í–∏–¥–∏–º–æ—Å—Ç—å –∑–≤—ë–∑–¥ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏)
            const cloudiness = data.clouds ? data.clouds.all : 0;
            let starVisibility = '';
            if (cloudiness < 20) starVisibility = '–û—Ç–ª–∏—á–Ω–∞—è';
            else if (cloudiness < 50) starVisibility = '–•–æ—Ä–æ—à–∞—è';
            else if (cloudiness < 80) starVisibility = '–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è';
            else starVisibility = '–ü–ª–æ—Ö–∞—è';
            
            starVisibilityElement.textContent = starVisibility;
            
            // –Ø—Ä–∫–æ—Å—Ç—å –ª—É–Ω–Ω–æ–≥–æ —Å–≤–µ—Ç–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–∞–∑—ã –ª—É–Ω—ã)
            let moonLight = '';
            if (moonPhase < 0.2 || moonPhase > 0.8) moonLight = '–°–ª–∞–±—ã–π';
            else if (moonPhase < 0.4 || moonPhase > 0.6) moonLight = '–£–º–µ—Ä–µ–Ω–Ω—ã–π';
            else moonLight = '–Ø—Ä–∫–∏–π';
            
            moonLightElement.textContent = moonLight;
        }
// –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
let networkErrorDiv = null;

// –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
function createErrorDiv() {
  if (!networkErrorDiv) {
    networkErrorDiv = document.createElement('div');
    networkErrorDiv.id = 'network-error';
    networkErrorDiv.className = 'fixed top-0 left-0 right-0 bg-red-600 text-white p-2 text-center z-50';
    document.body.appendChild(networkErrorDiv);
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
function showErrorMessage(message) {
  createErrorDiv();
  networkErrorDiv.innerText = message;
  networkErrorDiv.style.display = 'block';
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
function hideErrorMessage() {
  if (networkErrorDiv) {
    networkErrorDiv.style.display = 'none';
  }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
if (!navigator.onLine) {
  showErrorMessage('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
window.addEventListener('offline', () => {
  showErrorMessage('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
window.addEventListener('online', () => {
  hideErrorMessage();
  fetchWeatherData(); // –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
});

// –í–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
async function fetchWeatherData() {
  try {
    const response = await fetch(apiUrl);
    if (!response.ok) {
      throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö');
    }
    const data = await response.json();
    updateWeather(data);
  } catch (error) {
    // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏ –∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ —Å–±–æ—è
    if (!navigator.onLine) {
      showErrorMessage('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
    } else {
      // –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∑–¥–µ—Å—å
    }
  }
}

// –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤
fetchWeatherData();
    </script>
</body>
</html>